{% extends "campaigns/base.html" %}

{% block content %}

<!DOCTYPE html>
<html lang="en" dir="Itr">
<br />
<head class="campaign_banner">
  {% load static %}
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="{% static 'campaign_details.css' %}" />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Inter:400,800,900&display=swap"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
  />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <link
    href="https://fonts.cdnfonts.com/css/intelone-display"
    rel="stylesheet"
  />

  <meta charset="utf-8" />

</head>

<body>
<div class="campaigns_container">
  <div id="campaign-banner">
    <div id="campaign_title">
      <strong> <h1>{{ campaign.title }}</h1> </strong>
    </div>
    <br>

    <br>

    <div id="campaign_details_image">
      {% if campaign.image %}
      <img
        class="campaign_details_image"
        height="300"
        width="300"
        src="{{ campaign.image.url }} "
      />
      {% endif %}
    </div>
    <br />
  </div>

  <div class="title-and-description">
  
    <div id="campaign_info">Description:</div>
    <h3 id="try">{{ campaign.description }}</h3>
    <div id="dates">
      <div id="campaign_info">Campaign Begins at:&nbsp;</div>
      {{ campaign.start_date }}
      <div id="campaign_info">, Ends at:&nbsp;</div>
      {{ campaign.end_date }}
    </div>
  </div>

  <div id="author">
    <div id="author_info">Managed by:</div>
    <h4 id="managers-names">{{ campaign.manager }}</h4>
    <div id="author_info">Last edited by:</div>
    <h4 id="managers-names">{{ campaign.author }}</h4>





    <li class="dropdown" id="authors-dropdown">

  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false" id="managers_options">
    
    Campaign options
    
  </button>
      <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="CampaignDropDown">

        <li><a class="dropdown-item" href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/update" >
          Update
        </a></li>

        <li><a class="dropdown-item" href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/delete" onclick="return confirm('Are you sure you want to delete this campaign?\n\nThis action is IRREVERSABLE!')">
          Delete
        </a></li>

        <li><a class="dropdown-item" href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/close" onclick="return confirm('Are you sure you want to close this campaign? \n\nThis action moves your campaign to archive.')">
          Close
        </a></li>
      </ul>   

    </li>




  </div>

  <div id="statistics">
        <form
        action="{% url 'campaigns:campaign_like' campaign.id %}"
        method="POST"
      >
        {% csrf_token %}
        <input type="hidden" name="campaign_id" value="{{campaign.id}}" />
        {% if campaign.campaign_opened == True %}
        {% if user not in campaign.likes.all%}
        <button id="thumb_up" class="material-icons" type="submit">
          thumb_up
        </button>
        {% else%}
        <button id="thumb_down" class="material-icons" type="submit">
          thumb_up
        </button>
        {% endif %}
        {% endif %}
        <div><strong> {{ campaign.likes.all.count }} likes </strong></div>
      </form>


    
    <form
      action="{% url 'campaigns:campaign-participate' campaign.id %}"
      method="POST"
    >
      {% csrf_token %}
      <input type="hidden" name="campaign_id" value="{{campaign.id}}" />
      {% if campaign.campaign_opened == True %}

      {% if user not in campaign.participants.all %}
      <button id="thumb_up" class="material-icons" type="submit">
        group add
      </button>
      {% else%}
      <button id="thumb_down" class="material-icons" type="submit">
        person_remove
      </button>
      {% endif %}
      {% endif %}

      <div>
        <strong> {{ campaign.participants.all.count }} participants </strong>
      </div>
    </form>

{% if campaign.campaign_opened == True %}
    {% if user.is_authenticated and user in campaign.participants.all %}
    <a
      href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/create"
      style="color: aqua"
      data-role="button"
      data-inline="true"
    >
      <button type="button" class="btn btn-outline-light">
        Suggest an idea
      </button>
    </a>
    {% endif %} 

    {% if user.is_authenticated and user == campaign.author or user == campaign.manager %}


    {% endif %}
    {% endif %}
  </div>

  <div id="ideas">

    <div class="ideas_double_container">
      <div class="ideas_container">
        <div class="ideas_banner">

        <h4 id="ideas_count">
          This campaign has 
          <strong><strong>{{ideas.all.count}}</strong></strong> 
          Ideas</h4>
    <span class="sorting_options">

    <li class="dropdown" id="authors-dropdown">

      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu3" data-bs-toggle="dropdown" aria-expanded="false" id="managers_options">
        Sort by
      </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
    
            <li>      
              <a
              class="dropdown-item"
              href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/"
            >
                Date added
            </a></li>
    
            <li>      <a
              class="dropdown-item"
              href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/top_ideas"
            >
                Popularity
            </a></li>

    
          </ul>
        </li>


      </span>



    </div>

<br>
    {% for idea in ideas %}
    <div class="accordion" id="accordionExample">
      {% if forloop.counter == 1 %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="idea{{ forloop.counter }}">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}">
            <a
              href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}"
              style="color: #0071c5"
            >
            <strong>{{ idea.idea_title }}</strong>
          </a>

          </button>
          
        </h2>
        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse show" aria-labelledby="idea{{ forloop.counter }}" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <strong>Background:</strong> {{ idea.background }}
            <br>
            <strong>Solution:</strong> {{ idea.solution }}
            <br>
            <strong>Impact:</strong> {{ idea.impact }}
            <br>
            <br>
            Sugegsted by the <strong>{{ idea.impact }}</strong> team in <strong>{{ idea.idea_created_at }}</strong>
            <div style="float: right">
              <form
                action="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}/like/"
                method="POST"
              >
                {% csrf_token %}
                <input
                  type="hidden"
                  name="campaign_id"
                  value="{{campaign.id}}"
                />
                {% if user not in idea.idea_likes.all %}
                <button
                  id="thumb_up_idea"
                  class="material-icon"
                  type="submit"
                >
                  thumb_up
                </button>
                {% else%}
                <button
                  id="thumb_down_idea"
                  class="material-icons"
                  type="submit"
                >

                  thumb_down
                </button>
                {% endif %}
              </form>
            </div>
            <div
              class="idea-num-of-likes"
              style="float: right; padding-right: 10px"
            >
              {{ idea.idea_likes.all.count }} likes
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      {% if forloop.counter != 1 %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">
            <a
            href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}"
            style="color: #0071c5"
          >
            <strong>{{ idea.idea_title }}</strong>
          </a>
          </button>
        </h2>
        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <strong>Background:</strong> {{ idea.background }}
            <br>
            <strong>Solution:</strong> {{ idea.solution }}
            <br>
            <strong>Impact:</strong> {{ idea.impact }} 
            <br>
            <br>
            Sugegsted by the <strong>{{ idea.impact }}</strong> team in <strong>{{ idea.idea_created_at }}</strong>
            <div style="float: right">
              <form
                action="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}/like/"
                method="POST"
              >
                {% csrf_token %}
                <input
                  type="hidden"
                  name="campaign_id"
                  value="{{campaign.id}}"
                />
                {% if user not in idea.idea_likes.all %}
                <button
                  id="thumb_up_idea"
                  class="material-icons"
                  type="submit"
                >
                  thumb_up
                </button>
                {% else%}
                <button
                  id="thumb_down_idea"
                  class="material-icons"
                  type="submit"
                >
                  thumb_down
                </button>
                {% endif %}
              </form>
            </div>
            <div
              class="idea-num-of-likes"
              style="float: right; padding-right: 10px"
            >
              {{ idea.idea_likes.all.count }} likes
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      <br>
    </div>
    {% endfor %}












        {% comment %} <div class="idea_col">
          {% for idea in ideas %}
          <br />
          <div class="idea_row">
            <a
              href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}"
              style="color: #0071c5"
            >
              {{ idea.idea_title }}
            </a>
            <br />
            {{ idea.solution }}
            <br /
            <div>
              <br />
              <div id="idea_info">Suggested by: {{idea.author}}</div>

              Suggested URL:
              <a href="{{idea.idea_url}}" style="color: #0071c5">
                {{idea.idea_url}}
              </a>
              <div style="float: right">
                <form
                  action="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}/like/"
                  method="POST"
                >
                  {% csrf_token %}
                  <input
                    type="hidden"
                    name="campaign_id"
                    value="{{campaign.id}}"
                  />
                  {% if user not in idea.idea_likes.all %}
                  <button
                    id="thumb_up_idea"
                    class="material-icons"
                    type="submit"
                  >
                    thumb_up
                  </button>
                  {% else%}
                  <button
                    id="thumb_down_idea"
                    class="material-icons"
                    type="submit"
                  >
                    thumb_down
                  </button>
                  {% endif %}
                </form>
              </div>
              <div
                class="idea-num-of-likes"
                style="float: right; padding-right: 10px"
              >
                {{ idea.idea_likes.all.count }} likes
              </div>
            </div>
          </div>
          {% endfor %}
        </div> {% endcomment %}

      </div>

    </div>
    <div class="active_users">
      TESTTTTTTTT
    </div>
  </div>
</div>
</body>
</html>
{% endblock %}
