{% extends "campaigns/base.html" %} {% block content %}

<!DOCTYPE html>
<html lang="en" dir="ltr">
  <br />
  <head class="campaign_banner">
    {% load static %}
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'campaign_details.css' %}" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Inter:400,800,900&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.cdnfonts.com/css/intelone-display"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <meta charset="utf-8" />
  </head>

  <body>
    <div class="campaigns_container">
      <div id="campaign-banner">
        <div id="campaign_title">
          <strong> <h1>{{ campaign.title }}</h1> </strong>
        </div>


        {% if user not in campaign.favorites.all %}
        <a href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/add_favorite/">
        <span class="material-symbols-outlined" type="submit">
          star
        </span>
      </a>
      {% else %}
      <a href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/remove_favorite/">
        <style>
          .material-symbols-outlined {
            font-variation-settings:
            'FILL' 1,
            'wght' 400,
            'GRAD' 0,
            'opsz' 48
          }
        </style>
        <span class="material-symbols-outlined" type="submit" style="'FILL' 1 !important;">
          star
        </span>
      

      </a>

        {% comment %} <form action="http://127.0.0.1:8000/campaigns/{{campaign.id}}/add_favorite/" method="POST">
          {% csrf_token %}
          <input type="hidden" name="campaign_id" value="{{campaign.id}}"/>
          {% if user not in campaign.favorites.all %}
          <button class="material-symbols-outlined" type="submit">
          star
          </button>
          {% else %}
          <span class="material-symbols-outlined1" type="submit">
          star
          </span>
          {% endif %}
          <br>
       </form> {% endcomment %}


        {% endif %}

        {% if campaign.campaign_opened == False %}
        <div class="event_closed">

        <span class="material-symbols-outlined" style="font-size: xxx-large;">
          event_busy
        </span>
      </div>
        {% endif %}
        {% if campaign.campaign_opened == True %}
        <div class="event_available" >
        
        <span class="material-symbols-outlined" style="font-size: xxx-large;">
          event_available
        </span>
      </div>
        {% endif %}
        <br />

        <br />

        <div id="campaign_details_image">
          {% if campaign.image %}
          <img
            class="campaign_details_image"
            height="300"
            width="300"
            src="{{ campaign.image.url }} "
          />
          {% endif %}
        </div>
        <br />
      </div>

      <div class="title-and-description">
        <div id="campaign_info">Description:</div>
        <h3 id="try">{{ campaign.description }}</h3>
        <div class="dates">
          <div class="campaign_info_start">
            Campaign Begins at:&nbsp;
            <span id="start_date">
              {{ campaign.start_date }}
            </span>
          </div>
          <div  class="campaign_info_end">
            Campaign Ends at:&nbsp;
            <span id="end_date">
              {{ campaign.end_date }}
            </span>
          </div>
        </div>
      </div>

      <div id="author">
        <div id="author_info">Managed by:</div>
        <h4 id="managers-names">{{ campaign.manager }}</h4>
        <div id="author_info">Last edited by:</div>
        <h4 id="managers-names">{{ campaign.author }}</h4>

        {% if user.is_authenticated and user == campaign.author or user == campaign.manager %}

        <li class="dropdown" id="authors-dropdown">
          <button
            class="btn btn-secondary dropdown-toggle"
            type="button"
            id="dropdownMenu2"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            id="managers_options"
          >
            Advanced Options
          </button>
          <ul
            class="dropdown-menu"
            aria-labelledby="navbarDropdown"
            id="CampaignDropDown"
          >
            <li>
              <a
                class="dropdown-item"
                href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/update"
              >
                Update
              </a>
            </li>

            <li>
              <a
                class="dropdown-item"
                href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/delete"
                onclick="return confirm('Are you sure you want to delete this campaign?\n\nThis action is IRREVERSABLE!')"
              >
                Delete
              </a>
            </li>

            <li>
              <a
                class="dropdown-item"
                href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/close"
                onclick="return confirm('Are you sure you want to close this campaign? \n\nThis action moves your campaign to archive.')"
              >
                Close
              </a>
            </li>
          </ul>
        </li>

        {% endif %}
      </div>

      <div id="statistics">
        <form
          action="{% url 'campaigns:campaign_like' campaign.id %}"
          method="POST"
        >
          {% csrf_token %}
          <input type="hidden" name="campaign_id" value="{{campaign.id}}" />
          {% if campaign.campaign_opened == True %} 
          {% if user not in campaign.likes.all%}
          <button id="thumb_up" class="material-icons" type="submit">
            thumb_up
          </button>
          {% else%}
          <button id="thumb_down" class="material-icons" type="submit">
            thumb_up
          </button>
          {% endif %}
          {% endif %} 
          <div><strong> {{ campaign.likes.all.count }} likes </strong></div>
        </form>

        <form
          action="{% url 'campaigns:campaign-participate' campaign.id %}"
          method="POST"
        >
          {% csrf_token %}
          <input type="hidden" name="campaign_id" value="{{campaign.id}}" />
          {% if campaign.campaign_opened == True %}
          {% if user not in campaign.participants.all %}
          <button id="thumb_up" class="material-icons" type="submit">
            group add
          </button>
          {% else%}
          <button id="thumb_down" class="material-icons" type="submit">
            person_remove
          </button>
          {% endif %}
          {% endif %}

          <div>
            <strong>
              {{ campaign.participants.all.count }} participants
            </strong>
          </div>
        </form>

        {% if campaign.campaign_opened == True %}
         {% if user.is_authenticated and user in campaign.participants.all %}
        <a
          href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/create"
          style="color: aqua"
          data-role="button"
          data-inline="true"
        >
          <button type="button" class="btn btn-outline-light">
            Suggest an idea
          </button>
        </a>
        {% endif %} 
        {% endif %}
      </div>

      <div class="ideas">
        <div class="ideas_double_container">
          <div class="ideas_container">
            <div class="ideas_banner">
              <h4 id="ideas_count">
                This campaign has
                <strong><strong>{{ideas.all.count}}</strong></strong>
                ideas
              </h4>
              <span class="sorting_options">
                <li class="dropdown" id="authors-dropdown">
                  <button
                    class="btn btn-secondary dropdown-toggle"
                    type="button"
                    id="dropdownMenu3"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    Sort by
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li>
                      <a
                        class="dropdown-item"
                        href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/"
                      >
                        Date added
                      </a>
                    </li>

                    <li>
                      <a
                        class="dropdown-item"
                        href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/top_ideas"
                      >
                        Popularity
                      </a>
                    </li>
                  </ul>
                </li>
              </span>
            </div>

            <br />
            {% for idea in ideas %}
            <div class="accordion" id="accordionExample">
              {% if forloop.counter == 1 %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="idea{{ forloop.counter }}">
                  <button
                    class="accordion-button"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse{{ forloop.counter }}"
                    aria-expanded="true"
                    aria-controls="collapse{{ forloop.counter }}"
                  >
                    <a
                      href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}"
                      style="color: #0071c5"
                    >
                      <strong>{{ idea.idea_title }}</strong>
                    </a>
                  </button>
                </h2>
                <div
                  id="collapse{{ forloop.counter }}"
                  class="accordion-collapse collapse show"
                  aria-labelledby="idea{{ forloop.counter }}"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body">
                    <strong>Background:</strong> {{ idea.background }}
                    <br />
                    <strong>Solution:</strong> {{ idea.solution }}
                    <br />
                    <strong>Impact:</strong> {{ idea.impact }}
                    <br />
                    <br />
                    Sugegsted by the <strong>{{ idea.team }}</strong> team in
                    <strong>{{ idea.idea_created_at }}</strong>
                    <div style="float: right">
                      <form
                        action="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}/like/"
                        method="POST"
                      >
                        {% csrf_token %}
                        <input
                          type="hidden"
                          name="campaign_id"
                          value="{{campaign.id}}"
                        />
                        {% if user not in idea.idea_likes.all %}
                        <button
                          id="thumb_up_idea"
                          class="material-icons"
                          type="submit"
                        >
                          thumb_up
                        </button>
                        {% else%}
                        <button
                          id="thumb_down_idea"
                          class="material-icons"
                          type="submit"
                        >
                          thumb_down
                        </button>
                        {% endif %}
                      </form>
                    </div>
                    <div
                      class="idea-num-of-likes"
                      style="float: right; padding-right: 10px"
                    >
                      {{ idea.idea_likes.all.count }} likes
                    </div>
                  </div>
                </div>
              </div>
              {% endif %} {% if forloop.counter != 1 %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse{{ forloop.counter }}"
                    aria-expanded="false"
                    aria-controls="collapse{{ forloop.counter }}"
                  >
                    <a
                      href="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}"
                      style="color: #0071c5"
                    >
                      <strong>{{ idea.idea_title }}</strong>
                    </a>
                  </button>
                </h2>
                <div
                  id="collapse{{ forloop.counter }}"
                  class="accordion-collapse collapse"
                  aria-labelledby="heading{{ forloop.counter }}"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body">
                    <strong>Background:</strong> {{ idea.background }}
                    <br />
                    <strong>Solution:</strong> {{ idea.solution }}
                    <br />
                    <strong>Impact:</strong> {{ idea.impact }}
                    <br />
                    <br />
                    Sugegsted by the <strong>{{ idea.team }}</strong> team in
                    <strong>{{ idea.idea_created_at }}</strong>
                    <div style="float: right">
                      <form
                        action="http://127.0.0.1:8000/campaigns/{{campaign.id}}/ideas/{{idea.id}}/like/"
                        method="POST"
                      >
                        {% csrf_token %}
                        <input
                          type="hidden"
                          name="campaign_id"
                          value="{{campaign.id}}"
                        />
                        {% if user not in idea.idea_likes.all %}
                        <button
                          id="thumb_up_idea"
                          class="material-icons"
                          type="submit"
                        >
                          thumb_up
                        </button>
                        {% else%}
                        <button
                          id="thumb_down_idea"
                          class="material-icons"
                          type="submit"
                        >
                          thumb_down
                        </button>
                        {% endif %}
                      </form>
                    </div>
                    <div
                      class="idea-num-of-likes"
                      style="float: right; padding-right: 10px"
                    >
                      {{ idea.idea_likes.all.count }} likes
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}
              <br />
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
{% endblock %}
